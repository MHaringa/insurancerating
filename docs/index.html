<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Analytic Insurance Rating Techniques â€¢ insurancerating</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Analytic Insurance Rating Techniques">
<meta property="og:description" content="Methods for insurance rating. It helps actuaries to implement GLMs within all relevant steps needed to construct
 a risk premium from raw data. It provides a data driven strategy for the construction of insurance tariff classes.
 This strategy is based on the work by Antonio and Valdez (2012) &lt;doi:10.1007/s10182-011-0152-7&gt;. It also provides recipes
 on how to easily perform one-way, or univariate, analyses on an insurance portfolio. In addition it adds functionality
 to include reference categories in the levels of the coefficients in the output of a generalized linear regression analysis.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">insurancerating</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mharinga/insurancerating/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="insurancerating-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#insurancerating-" class="anchor"></a>insurancerating <img src="logo.png" align="right" alt="" width="120">
</h1></div>
<!-- badges: start -->

<p>The goal of <code>insurancerating</code> is to give analytic techniques that can be used in insurance rating. It helps actuaries to implement GLMs within all relevant steps needed to construct a risk premium from raw data. It provides a data driven strategy for the construction of tariff classes in P&amp;C insurance. The goal is to bin the continuous factors such that categorical risk factors result which capture the effect of the covariate on the response in an accurate way, while being easy to use in a generalized linear model (GLM).</p>
<p><code>insurancerating</code> also provides recipes on how to easily perform univariate analyses on an insurance portfolio. In addition it adds functionality to include reference categories in the levels of the coefficients in the output of a generalized linear regression analysis.</p>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Install insurancerating from CRAN:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"insurancerating"</span><span class="op">)</span></code></pre></div>
<p>Or the development version from GitHub:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.packages("remotes")</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"MHaringa/insurancerating"</span><span class="op">)</span></code></pre></div>
</div>
<div id="example-1" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1" class="anchor"></a>Example 1</h2>
<p>This is a basic example which shows the techniques provided in insurancerating.</p>
<p>The first part shows how to fit a GAM for the variable <em>age_policyholder</em> in the MTPL dataset:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mharinga/insurancerating">insurancerating</a></span><span class="op">)</span>

<span class="co"># Claim frequency </span>
<span class="va">age_policyholder_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_gam.html">fit_gam</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MTPL</span>, 
                                      nclaims <span class="op">=</span> <span class="va">nclaims</span>, 
                                      x <span class="op">=</span> <span class="va">age_policyholder</span>, 
                                      exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span>

<span class="co"># Claim severity </span>
<span class="va">age_policyholder_severity</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_gam.html">fit_gam</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">MTPL</span>, 
                                     nclaims <span class="op">=</span> <span class="va">nclaims</span>, 
                                     x <span class="op">=</span> <span class="va">age_policyholder</span>, 
                                     exposure <span class="op">=</span> <span class="va">exposure</span>, 
                                     amount <span class="op">=</span> <span class="va">amount</span>, 
                                     model <span class="op">=</span> <span class="st">"severity"</span><span class="op">)</span></code></pre></div>
<p>Create plot:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">age_policyholder_frequency</span>, show_observations <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/plotgam-1.png"><!-- --></p>
<p>Determine classes for the claim frequency (the points show the ratio between the observed number of claims and exposure for each age). This method is based on the work by Henckaerts et al.Â (2018), see <code><a href="reference/construct_tariff_classes.html">?construct_tariff_classes</a></code> for the reference.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clusters_freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/construct_tariff_classes.html">construct_tariff_classes</a></span><span class="op">(</span><span class="va">age_policyholder_frequency</span><span class="op">)</span>
<span class="va">clusters_sev</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/construct_tariff_classes.html">construct_tariff_classes</a></span><span class="op">(</span><span class="va">age_policyholder_severity</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">clusters_freq</span>, show_observations <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/figfreq-1.png"><!-- --></p>
<p>In this example the term <em>exposure</em> is a measure of what is being insured. Here an insured vehicle is an exposure. If the vehicle is insured as of July 1 for a certain year, then during that year, this would represent an exposure of 0.5 to the insurance company.</p>
<p>The figure shows that younger policyholders have a higher risk profile. The fitted GAM is lower than might be expected from the observed claim frequency for policyholders of age 19. This is because there are very few young policyholders of age 19 present in the portfolio.</p>
<p>The GAM for the claim severity :</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">age_policyholder_severity</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_observations <span class="op">=</span> <span class="cn">TRUE</span>, remove_outliers <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/figsev-1.png"><!-- --></p>
<p>The second part adds the constructed tariff classes for the variable <code>age_policyholder</code> to the dataset, and sets the base level of the factor <code>age_policyholder</code> to the level with the largest exposure. In this example for claim frequency the class for ages (39,50], which contains the largest exposure.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">MTPL</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>age_policyholder_freq_cat <span class="op">=</span> <span class="va">clusters_freq</span><span class="op">$</span><span class="va">tariff_classes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.character</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu">where</span><span class="op">(</span><span class="va">is.factor</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="reference/biggest_reference.html">biggest_reference</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">exposure</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  
<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 30,000</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 8</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_policyholder          &lt;int&gt; 70, 40, 78, 49, 59, 71, 55, 52, 51, 47, 62, â€¦</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="do">## $ nclaims                   &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0,â€¦</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $ exposure                  &lt;dbl&gt; 1.0000000, 1.0000000, 1.0000000, 1.0000000, â€¦</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $ amount                    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 2607, 0, 0, 0, 0, 2890, 0,â€¦</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="do">## $ power                     &lt;int&gt; 106, 74, 65, 64, 29, 66, 43, 55, 100, 66, 44â€¦</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $ bm                        &lt;int&gt; 5, 3, 8, 10, 1, 6, 2, 2, 1, 2, 1, 2, 2, 9, 5â€¦</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="do">## $ zip                       &lt;fct&gt; 1, 1, 2, 1, 3, 3, 3, 3, 3, 3, 2, 1, 1, 2, 2,â€¦</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_policyholder_freq_cat &lt;fct&gt; "(39,84]", "(39,84]", "(39,84]", "(39,84]", â€¦</span></span></code></pre></div>
<p>The last part is to fit a <em>generalized linear model</em>. <code><a href="reference/rating_factors.html">rating_factors()</a></code> prints the output including the reference group.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_freq1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">nclaims</span> <span class="op">~</span> <span class="va">age_policyholder_freq_cat</span>, offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">exposure</span><span class="op">)</span>, 
                  family <span class="op">=</span> <span class="st">"poisson"</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>

<span class="va">model_freq2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">nclaims</span> <span class="op">~</span> <span class="va">age_policyholder_freq_cat</span> <span class="op">+</span> <span class="va">age_policyholder</span>, offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">exposure</span><span class="op">)</span>, 
                  family <span class="op">=</span> <span class="st">"poisson"</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>

<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rating_factors.html">rating_factors</a></span><span class="op">(</span><span class="va">model_freq1</span>, <span class="va">model_freq2</span><span class="op">)</span> 
<span class="va">x</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [34mSignificance levels: *** p &lt; 0.001; ** p &lt; 0.01;  * p &lt; 0.05; . p &lt; 0.1[39m                risk_factor            level est_model_freq1 est_model_freq2</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1               (Intercept)      (Intercept)    0.117926 ***    0.245890 ***</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2 age_policyholder_freq_cat          (39,84]    1.000000        1.000000    </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 age_policyholder_freq_cat          [18,25]    2.216848 ***    1.453099 ***</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 age_policyholder_freq_cat          (25,32]    1.517625 ***    1.073952    </span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 age_policyholder_freq_cat          (32,39]    1.227861 ***    0.952683    </span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 age_policyholder_freq_cat          (84,95]    0.588749        0.901689    </span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 7          age_policyholder age_policyholder          NA        0.986728 ***</span></span></code></pre></div>
<p><code><a href="reference/autoplot.riskfactor.html">autoplot.riskfactor()</a></code> creates a figure. The base level of the factor <code>age_policyholder_freq_cat</code> is the group with the largest exposure and is shown first.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example3a1-1.png"><!-- --></p>
<p>Include <code>model_data</code> to sort the clustering in the original order. Ordering the factor <code>age_policyholder_freq_cat</code> only works when <code><a href="reference/biggest_reference.html">biggest_reference()</a></code> is used to set the base level of the factor to the level with the largest exposure.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/rating_factors.html">rating_factors</a></span><span class="op">(</span><span class="va">model_freq1</span>, <span class="va">model_freq2</span>, model_data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example3b-1.png"><!-- --></p>
<p>The following graph includes the exposure as a bar graph and shows some more options:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/rating_factors.html">rating_factors</a></span><span class="op">(</span><span class="va">model_freq1</span>, <span class="va">model_freq2</span>, model_data <span class="op">=</span> <span class="va">dat</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, linetype <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </code></pre></div>
<p><img src="reference/figures/example3c-1.png"><!-- --></p>
<p>Add predictions to the data set:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dat_pred</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/add_prediction.html">add_prediction</a></span><span class="op">(</span><span class="va">model_freq1</span>, <span class="va">model_freq2</span><span class="op">)</span> 

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">dat_pred</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Rows: 30,000</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Columns: 10</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_policyholder          &lt;int&gt; 70, 40, 78, 49, 59, 71, 55, 52, 51, 47, 62, â€¦</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="do">## $ nclaims                   &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0,â€¦</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="do">## $ exposure                  &lt;dbl&gt; 1.0000000, 1.0000000, 1.0000000, 1.0000000, â€¦</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="do">## $ amount                    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 2607, 0, 0, 0, 0, 2890, 0,â€¦</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="do">## $ power                     &lt;int&gt; 106, 74, 65, 64, 29, 66, 43, 55, 100, 66, 44â€¦</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="do">## $ bm                        &lt;int&gt; 5, 3, 8, 10, 1, 6, 2, 2, 1, 2, 1, 2, 2, 9, 5â€¦</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="do">## $ zip                       &lt;fct&gt; 1, 1, 2, 1, 3, 3, 3, 3, 3, 3, 2, 1, 1, 2, 2,â€¦</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="do">## $ age_policyholder_freq_cat &lt;fct&gt; "(39,84]", "(39,84]", "(39,84]", "(39,84]", â€¦</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pred_nclaims_model_freq1  &lt;dbl&gt; 0.11792558, 0.11792558, 0.11792558, 0.117925â€¦</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="do">## $ pred_nclaims_model_freq2  &lt;dbl&gt; 0.09650865, 0.14409239, 0.08672539, 0.127766â€¦</span></span></code></pre></div>
<p>Compute indices of model performance for GLMs. The RMSE is the square root of the average of squared differences between prediction and actual observation and indicates the absolute fit of the model to the data. It can be interpreted as the standard deviation of the unexplained variance, and is in the same units as the response variable.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/model_performance.html">model_performance</a></span><span class="op">(</span><span class="va">model_freq1</span>, <span class="va">model_freq2</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## # Comparison of Model Performance Indices</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Model       |      AIC |      BIC | RMSE</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">## ----------------------------------------</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="do">## model_freq1 | 22983.34 | 23024.88 | 0.36</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="do">## model_freq2 | 22943.06 | 22992.92 | 0.36</span></span></code></pre></div>
<p>To test the stability of the predictive ability of the fitted model it might be helpful to determine the variation in the computed RMSE. The variation is calculated by computing the root mean squared errors from generated bootstrap replicates.</p>
<p>For claim severity models it might be helpful to test the variation in the RMSE in case the portfolio contains large claim sizes. The figure below shows that the variation in the RMSE of the frequency model is quite low (as expected). The dashed line shows the RMSE of the fitted (original) model, the other lines represent the 95% confidence interval.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/bootstrap_rmse.html">bootstrap_rmse</a></span><span class="op">(</span><span class="va">model_freq1</span>, <span class="va">dat</span>, n <span class="op">=</span> <span class="fl">100</span>, show_progress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/bootstraprmse-1.png"><!-- --></p>
<p>Check Poisson GLM for overdispersion. A dispersion ratio larger than one indicates overdispersion, this occurs when the observed variance is higher than the variance of the theoretical model. If the dispersion ratio is close to one, a Poisson model fits well to the data. A <em>p</em>-value &lt; .05 indicates overdispersion. Overdispersion &gt; 2 probably means there is a larger problem with the data: check (again) for outliers.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/check_overdispersion.html">check_overdispersion</a></span><span class="op">(</span><span class="va">model_freq1</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">##        dispersion ratio =     1.185</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="do">##   Pearson's Chi-Squared = 35554.163</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="do">##                 p-value =   &lt; 0.001</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Overdispersion detected.</span></span></code></pre></div>
<p>Misspecifications in GLMs cannot reliably be diagnosed with standard residual plots, and GLMs are thus often not as thoroughly checked as LMs. One reason why GLMs residuals are harder to interpret is that the expected distribution of the data changes with the fitted values. As a result, standard residual plots, when interpreted in the same way as for linear models, seem to show all kind of problems, such as non-normality, heteroscedasticity, even if the model is correctly specified. <code><a href="reference/check_residuals.html">check_residuals()</a></code> aims at solving these problems by creating readily interpretable residuals for GLMs that are standardized to values between 0 and 1, and that can be interpreted as intuitively as residuals for the linear model. This is achieved by a simulation-based approach, similar to the Bayesian p-value or the parametric bootstrap, that transforms the residuals to a standardized scale. This explanation is adopted from the <a href="https://cran.r-project.org/web/packages/DHARMa/vignettes/DHARMa.html">vignette for DHARMa</a>.</p>
<p>Detect deviations from the expected distribution, and produce a uniform quantile-quantile plot. The simulated residuals in the QQ plot below show no clear deviation from a Poisson distribution. Note that formal tests almost always yield significant results for the distribution of residuals and visual inspections (e.g.Â Q-Q plots) are preferable.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/check_residuals.html">check_residuals</a></span><span class="op">(</span><span class="va">model_freq1</span>, n_simulations <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## OK: residuals appear as from the expected distribution (p = 0.362).</span></span></code></pre></div>
<p><img src="reference/figures/normalitysim-1.png"><!-- --></p>
<p>It might happen that in the fitted model for a data point all simulations have the same value (e.g.Â zero), this returns the error message <em>Error in approxfun: need at least two non-NA values to interpolate</em>. If that is the case, it could help to increase the number of simulations (e.g.Â <em>n</em>â€„=â€„1000).</p>
</div>
<div id="example-2" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2" class="anchor"></a>Example 2</h2>
<p>This is a basic example which shows how to easily perform an univariate analysis on a MTPL portfolio using <code>insurancerating</code>.</p>
<p>An univariate analysis consists in the evaluation of overall claim frequency, severity and risk premium. Its main purpose lies in verifying the experience data reasonableness using previous experience comparison and professional judgement.</p>
<p><code><a href="reference/univariate.html">univariate()</a></code> shows the basic risk indicators split by the levels of the discrete risk factor:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mharinga/insurancerating">insurancerating</a></span><span class="op">)</span>
<span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, 
           x <span class="op">=</span> <span class="va">area</span>, <span class="co"># discrete risk factor</span>
           nclaims <span class="op">=</span> <span class="va">nclaims</span>, <span class="co"># number of claims</span>
           exposure <span class="op">=</span> <span class="va">exposure</span>, 
           premium <span class="op">=</span> <span class="va">premium</span>, 
           severity <span class="op">=</span> <span class="va">amount</span><span class="op">)</span> <span class="co"># loss</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    area  amount nclaims   exposure premium  frequency average_severity</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:    2 4063270      98  818.53973   51896 0.11972540         41461.94</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:    3 7945311     113  764.99178   49337 0.14771401         70312.49</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3:    1 6896187     146 1065.74795   65753 0.13699299         47234.16</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4:    0    6922       1   13.30685     902 0.07514927          6922.00</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    risk_premium loss_ratio average_premium</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:    4964.0474  78.296400        63.40071</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:   10386.1390 161.041632        64.49350</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 3:    6470.7486 104.880188        61.69658</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 4:     520.1832   7.674058        67.78464</span></span></code></pre></div>
<p>The following indicators are calculated:</p>
<ol>
<li>frequency (i.e.Â frequency = number of claims / exposure)</li>
<li>average_severity (i.e.Â average severity = severity / number of claims)</li>
<li>risk_premium (i.e.Â risk premium = severity / exposure = frequency x average severity)</li>
<li>loss_ratio (i.e.Â loss ratio = severity / premium)</li>
<li>average_premium (i.e.Â average premium = premium / exposure)</li>
</ol>
<p>Here the term <em>exposure</em> is a measure of what is being insured. For example, an insured vehicle is an exposure. If the vehicle is insured as of July 1 for a certain year, then during that year, this would represent an exposure of 0.5 to the insurance company. The term risk premium is used here as an equivalent of pure premium and burning cost.</p>
<p><code><a href="reference/univariate.html">univariate()</a></code> ignores missing input arguments, for instance only the claim frequency is calculated when <code>premium</code> and <code>severity</code> are unknown:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">##    area nclaims   exposure  frequency</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1:    2      98  818.53973 0.11972540</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2:    3     113  764.99178 0.14771401</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3:    1     146 1065.74795 0.13699299</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4:    0       1   13.30685 0.07514927</span></span></code></pre></div>
<p>However, the above table is small and easy to understand, the same information might be presented more effectively with a graph, as shown below.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example6-1.png"><!-- --></p>
<p>In <code><a href="reference/autoplot.univariate.html">autoplot.univariate()</a></code>, <code>show_plots</code> defines the plots to show and also the order of the plots. The following plots are available:</p>
<ol>
<li>frequency</li>
<li>average_severity</li>
<li>risk_premium</li>
<li>loss_ratio</li>
<li>average_premium</li>
<li>exposure</li>
<li>severity</li>
<li>nclaims</li>
<li>premium</li>
</ol>
<p>For example, to show the exposure and claim frequency plots:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example7-1.png"><!-- --></p>
<p>To check whether claim frequency is consistent over the years:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MTPL2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">2016</span><span class="op">:</span><span class="fl">2019</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">.</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, 
           exposure <span class="op">=</span> <span class="va">exposure</span>, by <span class="op">=</span> <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_plots <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/unnamed-chunk-3-1.png"><!-- --></p>
<p>To remove the bars from the plot with the line graph, add <code>background = FALSE</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span>, background <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example8-1.png"><!-- --></p>
<p><code>sort</code> orders the levels of the risk factor into descending order by exposure:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span>, background <span class="op">=</span> <span class="cn">FALSE</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example9-1.png"><!-- --></p>
<p><code>sort_manual</code> in <code><a href="reference/autoplot.univariate.html">autoplot.univariate()</a></code> can be used to sort the levels of the discrete risk factor into your own ordering. This makes sense when the levels of the risk factor has a natural order, or when not all levels of the risk factor are desired in the output.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span>, background <span class="op">=</span> <span class="cn">FALSE</span>, sort_manual <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"2"</span>, <span class="st">"3"</span>, <span class="st">"1"</span>, <span class="st">"0"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example10-1.png"><!-- --></p>
<p>The following graph shows some more options:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span>, exposure <span class="op">=</span> <span class="va">exposure</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_plots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">1</span><span class="op">)</span>, background <span class="op">=</span> <span class="cn">FALSE</span>, sort <span class="op">=</span> <span class="cn">TRUE</span>, ncol <span class="op">=</span> <span class="fl">2</span>, 
           color_bg <span class="op">=</span> <span class="st">"dodgerblue"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example11-1.png"><!-- --></p>
<p>Or create a bar graph for the number of claims:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/univariate.html">univariate</a></span><span class="op">(</span><span class="va">MTPL2</span>, x <span class="op">=</span> <span class="va">area</span>, nclaims <span class="op">=</span> <span class="va">nclaims</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">.</span>, show_plots <span class="op">=</span> <span class="fl">8</span>, coord_flip <span class="op">=</span> <span class="cn">TRUE</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example12-1.png"><!-- --></p>
<p>For continuous variables a histogram can be created:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/histbin.html">histbin</a></span><span class="op">(</span><span class="va">MTPL2</span>, <span class="va">premium</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example14-1.png"><!-- --></p>
<p>Two ways of displaying numerical data over a very wide range of values in a compact way are taking the logarithm of the variable, or omitting the outliers. Both do not show the original distribution, however. Another way is to create one bin for all the outliers. This yields both the original distribution, and also gives a feel for the number of outliers.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="reference/histbin.html">histbin</a></span><span class="op">(</span><span class="va">MTPL2</span>, <span class="va">premium</span>, right <span class="op">=</span> <span class="fl">110</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example15-1.png"><!-- --></p>
</div>
<div id="example-3" class="section level2">
<h2 class="hasAnchor">
<a href="#example-3" class="anchor"></a>Example 3</h2>
<p>This is a basic example which shows how to easily perform model refinement using <code>insurancerating</code>. <code>insurancerating</code> can be used to impose either smoothing to the parameter estimates or to add restrictions to the parameter estimates. These methods are deduced from the article <em>Third Party Motor Liability Ratemaking with R</em>, by Spedicato, G. (2012).</p>
<p>Fit (again) a Poisson GLM and a Gamma GLM, and combine them to determine premiums:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_freq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">nclaims</span> <span class="op">~</span> <span class="va">zip</span> <span class="op">+</span> <span class="va">age_policyholder_freq_cat</span>, 
                offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">exposure</span><span class="op">)</span>, 
                family <span class="op">=</span> <span class="st">"poisson"</span>, 
                data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>

<span class="va">mod_sev</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">amount</span> <span class="op">~</span> <span class="va">bm</span> <span class="op">+</span> <span class="va">zip</span>, 
               weights <span class="op">=</span> <span class="va">nclaims</span>, 
               family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">Gamma</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, 
               data <span class="op">=</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">amount</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span>

<span class="va">MTPL_premium</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/add_prediction.html">add_prediction</a></span><span class="op">(</span><span class="va">mod_freq</span>, <span class="va">mod_sev</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>premium <span class="op">=</span> <span class="va">pred_nclaims_mod_freq</span> <span class="op">*</span> <span class="va">pred_amount_mod_sev</span><span class="op">)</span></code></pre></div>
<p>Fit a burning model without restrictions. Even though restrictions could be applied to frequency and severity models, it is more appropriate to add restrictions (and smoothing) to the risk premium model.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_unrestricted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">premium</span> <span class="op">~</span> <span class="va">zip</span> <span class="op">+</span> <span class="va">bm</span> <span class="op">+</span> <span class="va">age_policyholder_freq_cat</span>, 
                         weights <span class="op">=</span> <span class="va">exposure</span>, 
                         family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">Gamma</a></span><span class="op">(</span>link <span class="op">=</span> <span class="st">"log"</span><span class="op">)</span>, 
                         data <span class="op">=</span> <span class="va">MTPL_premium</span><span class="op">)</span> </code></pre></div>
<p>Smoothing can be used to reduce the tolerance for rate change. In <code><a href="reference/smooth_coef.html">smooth_coef()</a></code>, <code>x_cut</code> is the name of the risk factor with clusters, <code>x_org</code> is the name of the original risk factor, <code>degree</code> is the order of the polynomial, and <code>breaks</code> is a numerical vector with new clusters for <code>x_org</code>. The smoothed estimates are added as an offset term to the model. An offset is just a fixed term added to the linear predictor, therefore if there is already an offset in the model, the offset terms are added together first (i.e.Â offsetâ€„=â€„logâ€†(<em>a</em>)â€…+â€…logâ€†(<em>b</em>)â€„=â€„logâ€†(<em>a</em>â€…â‹…â€…<em>b</em>)).</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/smooth_coef.html">smooth_coef</a></span><span class="op">(</span>x_cut <span class="op">=</span> <span class="st">"age_policyholder_freq_cat"</span>, 
              x_org <span class="op">=</span> <span class="st">"age_policyholder"</span>, 
              breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">95</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Formula: premium ~ zip + bm + offset(log(age_policyholder_freq_cat_smooth))</span></span></code></pre></div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> creates a figure for the smoothed estimates. The blue segments show the estimates from the unrestricted model. The red segments are the new estimates based on the polynomial.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/smooth_coef.html">smooth_coef</a></span><span class="op">(</span>x_cut <span class="op">=</span> <span class="st">"age_policyholder_freq_cat"</span>, 
              x_org <span class="op">=</span> <span class="st">"age_policyholder"</span>, 
              breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">95</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example18a-1.png"><!-- --></p>
<p><code>degree</code> can be used to change the order of the polynomial:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/smooth_coef.html">smooth_coef</a></span><span class="op">(</span>x_cut <span class="op">=</span> <span class="st">"age_policyholder_freq_cat"</span>, 
              x_org <span class="op">=</span> <span class="st">"age_policyholder"</span>, 
              degree <span class="op">=</span> <span class="fl">1</span>,
              breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">95</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example19-1.png"><!-- --></p>
<p><code><a href="reference/smooth_coef.html">smooth_coef()</a></code> must always be followed by <code><a href="reference/refit_glm.html">refit_glm()</a></code> to refit the GLM.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_restricted</span> <span class="op">&lt;-</span> <span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/smooth_coef.html">smooth_coef</a></span><span class="op">(</span>x_cut <span class="op">=</span> <span class="st">"age_policyholder_freq_cat"</span>, 
              x_org <span class="op">=</span> <span class="st">"age_policyholder"</span>, 
              breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">95</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/refit_glm.html">refit_glm</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Show rating factors</span>
<span class="fu"><a href="reference/rating_factors.html">rating_factors</a></span><span class="op">(</span><span class="va">burn_restricted</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [34mSignificance levels: *** p &lt; 0.001; ** p &lt; 0.01;  * p &lt; 0.05; . p &lt; 0.1[39m               risk_factor       level est_burn_restricted</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1              (Intercept) (Intercept)     9184.248396 ***</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                      zip           1        1.000000    </span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                      zip           0        0.354033 ***</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4                      zip           2        0.731117 ***</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5                      zip           3        0.753704 ***</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  age_policyholder_smooth     [18,23]        2.311122    </span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 7  age_policyholder_smooth     (23,28]        1.719606    </span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 8  age_policyholder_smooth     (28,33]        1.377440    </span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 9  age_policyholder_smooth     (33,38]        1.205472    </span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 age_policyholder_smooth     (38,43]        1.137252    </span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 age_policyholder_smooth     (43,48]        1.119032    </span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 age_policyholder_smooth     (48,53]        1.109767    </span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 age_policyholder_smooth     (53,58]        1.081112    </span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 age_policyholder_smooth     (58,63]        1.017424    </span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 age_policyholder_smooth     (63,68]        0.915763    </span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 age_policyholder_smooth     (68,73]        0.785889    </span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 17 age_policyholder_smooth     (73,78]        0.650267    </span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 18 age_policyholder_smooth     (78,83]        0.544060    </span></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 19 age_policyholder_smooth     (83,88]        0.515136    </span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 20 age_policyholder_smooth     (88,93]        0.624062    </span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 21                      bm          bm        1.037056 ***</span></span></code></pre></div>
<p>Most insurers have some form of a Bonus-Malus System in vehicle third party liability insurance. <code><a href="reference/restrict_coef.html">restrict_coef()</a></code> can be used to impose such restrictions. <code>restrictions</code> must be a data.frame with in the first column the name of the column for which the restrictions should be applied and in the second column the restricted coefficients. The following example shows restrictions on the risk factor for region <code>zip</code>:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">zip_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>zip <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span>,
                     zip_restricted <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.9</span>, <span class="fl">1</span>, <span class="fl">1.2</span><span class="op">)</span><span class="op">)</span>

<span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/restrict_coef.html">restrict_coef</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">zip_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Formula: premium ~ bm + age_policyholder_freq_cat + offset(log(zip_restricted))</span></span></code></pre></div>
<p>To adjust the glm, <code>restict_coef()</code> must always be followed by <code><a href="reference/refit_glm.html">refit_glm()</a></code>:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_restricted2</span> <span class="op">&lt;-</span> <span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/restrict_coef.html">restrict_coef</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">zip_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/refit_glm.html">refit_glm</a></span><span class="op">(</span><span class="op">)</span>

<span class="fu"><a href="reference/rating_factors.html">rating_factors</a></span><span class="op">(</span><span class="va">burn_restricted2</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [34mSignificance levels: *** p &lt; 0.001; ** p &lt; 0.01;  * p &lt; 0.05; . p &lt; 0.1[39m                 risk_factor       level est_burn_restricted2</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                (Intercept) (Intercept)      7766.514389 ***</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  age_policyholder_freq_cat     (39,84]         1.000000    </span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3  age_policyholder_freq_cat     [18,25]         2.172458 ***</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4  age_policyholder_freq_cat     (25,32]         1.491470 ***</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5  age_policyholder_freq_cat     (32,39]         1.209953 ***</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  age_policyholder_freq_cat     (84,95]         0.574445 ***</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 7             zip_restricted           0         0.800000    </span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 8             zip_restricted           1         0.900000    </span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 9             zip_restricted           2         1.000000    </span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 10            zip_restricted           3         1.200000    </span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 11                        bm          bm         1.037167 ***</span></span></code></pre></div>
<p><code><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot()</a></code> compares the restricted and the unrestricted estimates:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/restrict_coef.html">restrict_coef</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">zip_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="reference/figures/example23-1.png"><!-- --></p>
<p><code>burn_restricted3</code> combines <code><a href="reference/restrict_coef.html">restrict_coef()</a></code> and <code><a href="reference/smooth_coef.html">smooth_coef()</a></code>:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">burn_restricted3</span> <span class="op">&lt;-</span> <span class="va">burn_unrestricted</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/restrict_coef.html">restrict_coef</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">zip_df</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/smooth_coef.html">smooth_coef</a></span><span class="op">(</span>x_cut <span class="op">=</span> <span class="st">"age_policyholder_freq_cat"</span>, 
              x_org <span class="op">=</span> <span class="st">"age_policyholder"</span>, 
              breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">95</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/refit_glm.html">refit_glm</a></span><span class="op">(</span><span class="op">)</span> 
  
<span class="co"># Show rating factors</span>
<span class="fu"><a href="reference/rating_factors.html">rating_factors</a></span><span class="op">(</span><span class="va">burn_restricted3</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">## [34mSignificance levels: *** p &lt; 0.001; ** p &lt; 0.01;  * p &lt; 0.05; . p &lt; 0.1[39m               risk_factor       level est_burn_restricted3</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1              (Intercept) (Intercept)      7880.289822 ***</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2           zip_restricted           0         0.800000    </span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3           zip_restricted           1         0.900000    </span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4           zip_restricted           2         1.000000    </span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5           zip_restricted           3         1.200000    </span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6  age_policyholder_smooth     [18,23]         2.311122    </span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="do">## 7  age_policyholder_smooth     (23,28]         1.719606    </span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 8  age_policyholder_smooth     (28,33]         1.377440    </span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 9  age_policyholder_smooth     (33,38]         1.205472    </span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 10 age_policyholder_smooth     (38,43]         1.137252    </span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 11 age_policyholder_smooth     (43,48]         1.119032    </span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 12 age_policyholder_smooth     (48,53]         1.109767    </span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 13 age_policyholder_smooth     (53,58]         1.081112    </span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 14 age_policyholder_smooth     (58,63]         1.017424    </span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 15 age_policyholder_smooth     (63,68]         0.915763    </span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 16 age_policyholder_smooth     (68,73]         0.785889    </span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 17 age_policyholder_smooth     (73,78]         0.650267    </span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 18 age_policyholder_smooth     (78,83]         0.544060    </span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 19 age_policyholder_smooth     (83,88]         0.515136    </span></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 20 age_policyholder_smooth     (88,93]         0.624062    </span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 21                      bm          bm         1.036909 ***</span></span></code></pre></div>
<p>And add refined premiums to the data:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">premiums3</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_data.html">get_data</a></span><span class="op">(</span><span class="va">burn_restricted3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="reference/add_prediction.html">add_prediction</a></span><span class="op">(</span><span class="va">burn_restricted3</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">premiums3</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="do">##   age_policyholder age_policyholder_freq_cat_smooth age_policyholder_smooth</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 1               70                        0.7858894                 (68,73]</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 2               40                        1.1372518                 (38,43]</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="do">## 3               78                        0.6502670                 (73,78]</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="do">## 4               49                        1.1097671                 (48,53]</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="do">## 5               59                        1.0174238                 (58,63]</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a><span class="do">## 6               71                        0.7858894                 (68,73]</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="do">##   nclaims  exposure amount power bm zip age_policyholder_freq_cat</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="do">## 1       0 1.0000000      0   106  5   1                   (39,84]</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="do">## 2       0 1.0000000      0    74  3   1                   (39,84]</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="do">## 3       0 1.0000000      0    65  8   2                   (39,84]</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="do">## 4       0 1.0000000      0    64 10   1                   (39,84]</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 5       0 1.0000000      0    29  1   3                   (39,84]</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 6       0 0.4547945      0    66  6   3                   (39,84]</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="do">##   pred_nclaims_mod_freq pred_amount_mod_sev   premium zip_restricted</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 1            0.12314843            92178.78 11351.672            0.9</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 2            0.12314843            85686.38 10552.142            0.9</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 3            0.11069758            82808.65  9166.717            1.0</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 4            0.12314843           110644.28 13625.670            0.9</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 5            0.11751490            62444.85  7338.200            1.2</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="do">## 6            0.05344513            74953.96  4005.925            1.2</span></span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a><span class="do">##   pred_premium_burn_restricted3</span></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 1                      6681.109</span></span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 2                      8992.135</span></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 3                      6847.906</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 4                     11308.927</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 5                      9976.216</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a><span class="do">## 6                      9236.933</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=insurancerating">https://â€‹cloud.r-project.org/â€‹package=insurancerating</a>
</li>
<li>Browse source code at <br><a href="https://github.com/mharinga/insurancerating/">https://â€‹github.com/â€‹mharinga/â€‹insurancerating/â€‹</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>GPL (&gt;= 2)</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Martin Haringa <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=insurancerating"><img src="https://www.r-pkg.org/badges/version/insurancerating" alt="CRAN Status"></a></li>
<li><a href="https://cran.rstudio.com/package=insurancerating"><img src="https://cranlogs.r-pkg.org/badges/insurancerating?color=blue" alt="Downloads"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Martin Haringa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
